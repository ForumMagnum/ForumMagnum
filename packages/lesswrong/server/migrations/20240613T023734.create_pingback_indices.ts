import {updateCustomIndexes, updateIndexes} from '@/server/migrations/meta/utils.ts'
import {Posts} from '@/lib/collections/posts'
import Tags from '@/lib/collections/tags/collection.ts'
import {Comments} from '@/lib/collections/comments'

/**
 * Generated on 2024-06-13T02:37:34.260Z by `yarn makemigrations`
 * The following schema changes were detected:
 * -------------------------------------------
 * /Users/vlad/coding/dance/fm/ForumMagnum/schema/schema_to_accept.sql --- 1/2 --- Text (46 SQL parse errors, exceeded DFT_PARSE_ERROR_LIMIT)
 * Renamed from /Users/vlad/coding/dance/fm/ForumMagnum/schema/accepted_schema.sql to /Users/vlad/coding/dance/fm/ForumMagnum/schema/schema_to_accept.sql
 *  2 -- Do not edit this file directly. I 2 -- Do not edit this file directly. I
 *  . nstead, start a server and run "yarn . nstead, start a server and run "yarn
 *  .  makemigrations"                     .  makemigrations"
 *  3 -- as described in the README. This  3 -- as described in the README. This 
 *  . file should nevertheless be checked  . file should nevertheless be checked 
 *  . in to version control.               . in to version control.
 *  4 --                                   4 --
 *  5 -- Overall schema hash: 20b050ae1244 5 -- Overall schema hash: 2872f3475028
 *  . 047363b7fd236c840d9d                 . 7e336bb8848f5d034509
 *  6                                      6 
 *  7 -- Accepted on 2024-06-13T02:28:25.0 . 
 *  . 00Z by 20240613T022825.create_pingba . 
 *  . ck_indices.ts                        . 
 *  8                                      . 
 *  9 -- Extension "btree_gin", hash 7b207 7 -- Extension "btree_gin", hash 7b207
 *  . eefbb36f8109cca31911e6ab886          . eefbb36f8109cca31911e6ab886
 * 10 CREATE EXTENSION IF NOT EXISTS "btre 8 CREATE EXTENSION IF NOT EXISTS "btre
 * .. e_gin" CASCADE;                      . e_gin" CASCADE;
 * 11                                      9 
 * 
 * /Users/vlad/coding/dance/fm/ForumMagnum/schema/schema_to_accept.sql --- 2/2 --- Text (46 SQL parse errors, exceeded DFT_PARSE_ERROR_LIMIT)
 * 2792 -- Index "idx_Tags_parentTagId", h 2790 -- Index "idx_Tags_parentTagId", h
 * .... ash 4fd510db5b7ac6d006db6f08c6ce77 .... ash 4fd510db5b7ac6d006db6f08c6ce77
 * .... 4a                                 .... 4a
 * 2793 CREATE INDEX IF NOT EXISTS "idx_Ta 2791 CREATE INDEX IF NOT EXISTS "idx_Ta
 * .... gs_parentTagId" ON "Tags" USING bt .... gs_parentTagId" ON "Tags" USING bt
 * .... ree ("parentTagId");               .... ree ("parentTagId");
 * 2794                                    2792 
 * 2795 -- Index "idx_tags_pingbackPosts", 2793 -- Index "idx_tags_pingbackPosts",
 * ....  hash 8ddc1c1776f030c679242799aa6b ....  hash 77529d26c1e4d11b267d40cf25dc
 * .... 9a9d                               .... 0a97
 * 2796 CREATE INDEX IF NOT EXISTS "idx_ta 2794 CREATE INDEX IF NOT EXISTS "idx_ta
 * .... gs_pingbackPosts" ON "Tags" USING  .... gs_pingbackPosts" ON "Tags" USING 
 * .... gin (                              .... gin (("pingbacks" -> 'Posts'));
 * 2797   "status",                        .... 
 * 2798   "isFuture",                      .... 
 * 2799   "draft",                         .... 
 * 2800   "unlisted",                      .... 
 * 2801   "shortform",                     .... 
 * 2802   "hiddenRelatedQuestion",         .... 
 * 2803   "authorIsUnreviewed",            .... 
 * 2804   "groupId",                       .... 
 * 2805   ("pingbacks" -> 'Posts'),        .... 
 * 2806   "_id",                           .... 
 * 2807   "meta",                          .... 
 * 2808   "isEvent",                       .... 
 * 2809   "af",                            .... 
 * 2810   "frontpageDate",                 .... 
 * 2811   "curatedDate",                   .... 
 * 2812   "postedAt",                      .... 
 * 2813   "baseScore"                      .... 
 * 2814 );                                 .... 
 * 2815                                    2795 
 * 2816 -- Index "idx_tags_pingbackTags",  2796 -- Index "idx_tags_pingbackTags", 
 * .... hash bc8f6fa498fc1e83c1a467b6ac473 .... hash f41e825461685b0b06a1c2970c8c5
 * .... 968                                .... b61
 * 2817 CREATE INDEX IF NOT EXISTS "idx_ta 2797 CREATE INDEX IF NOT EXISTS "idx_ta
 * .... gs_pingbackTags" ON "Tags" USING g .... gs_pingbackTags" ON "Tags" USING g
 * .... in (                               .... in (("pingbacks" -> 'Tags'));
 * 2818   "status",                        .... 
 * 2819   "isFuture",                      .... 
 * 2820   "draft",                         .... 
 * 2821   "unlisted",                      .... 
 * 2822   "shortform",                     .... 
 * 2823   "hiddenRelatedQuestion",         .... 
 * 2824   "authorIsUnreviewed",            .... 
 * 2825   "groupId",                       .... 
 * 2826   ("pingbacks" -> 'Tags'),         .... 
 * 2827   "_id",                           .... 
 * 2828   "meta",                          .... 
 * 2829   "isEvent",                       .... 
 * 2830   "af",                            .... 
 * 2831   "frontpageDate",                 .... 
 * 2832   "curatedDate",                   .... 
 * 2833   "postedAt",                      .... 
 * 2834   "baseScore"                      .... 
 * 2835 );                                 .... 
 * 2836                                    2798 
 * 2837 -- Table "TypingIndicators", hash  2799 -- Table "TypingIndicators", hash 
 * .... b97ae11df17abd3e2fceb7427d545963   .... b97ae11df17abd3e2fceb7427d545963
 * 2838 CREATE TABLE "TypingIndicators" (  2800 CREATE TABLE "TypingIndicators" (
 * 
 * 
 * -------------------------------------------
 * (run `git diff --no-index schema/accepted_schema.sql schema/schema_to_accept.sql` to see this more clearly)
 *
 * - [ ] Write a migration to represent these changes
 * - [ ] Rename this file to something more readable
 * - [ ] Uncomment `acceptsSchemaHash` below
 * - [ ] Run `yarn acceptmigrations` to update the accepted schema hash (running makemigrations again will also do this)
 */
export const acceptsSchemaHash = "24d91ae3629f5201966f1bdb54d8d919";

export const up = async ({dbOutsideTransaction}: MigrationContext) => {
  await updateIndexes(Posts)
  await updateIndexes(Tags)
  await updateIndexes(Comments)
}

export const down = async ({db}: MigrationContext) => {
  // TODO, not required
}
