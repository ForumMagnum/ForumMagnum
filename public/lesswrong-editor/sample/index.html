<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>CKEditor 5 – balloon block editor build – development sample</title>
	<style>
		body {
			max-width: 800px;
			margin: 20px auto;
		}
	</style>
</head>
<body>

<h1>CKEditor 5 – balloon block editor build – development sample</h1>

<div id="presence-list-container"></div>
<div id="editor">
	<h2>Sample Post Editor</h2>
	<p>This is an instance of the <a
			href="https://ckeditor.com/docs/ckeditor5/latest/builds/guides/overview.html#balloon-editor">balloon block
			editor build</a>.</p>
	<figure class="image"><img src="../tests/manual/sample.jpg" alt="Autumn fields"></figure>
	<p>ab</p>
	<p><span class="math-tex">\(\frac{31}{312}\)</span></p>
	<script type="math/tex"> ws_* </script>
	<p>You can use this sample to validate whether your <a
			href="https://ckeditor.com/docs/ckeditor5/latest/builds/guides/development/custom-builds.html">custom build</a>
		works fine.</p>
</div>
<a onClick="console.log(window.CKEditor.getData())"> Log Contents </a>
<h1>CKEditor 5 – balloon block editor build – development sample (Comment Editor)</h1>

<div id="comment-editor">
	<h2>Sample Comment Editor</h2>
	<p>This is an instance of the <a
			href="https://ckeditor.com/docs/ckeditor5/latest/builds/guides/overview.html#balloon-editor">balloon block
			editor build</a>.</p>
	<figure class="image"><img src="../tests/manual/sample.jpg" alt="Autumn fields"></figure>
	<p>ab</p>
	<p><span class="math-tex">\(\frac{31}{312}\)</span></p>
	<script type="math/tex"> ws_* </script>
	<p>You can use this sample to validate whether your <a
			href="https://ckeditor.com/docs/ckeditor5/latest/builds/guides/development/custom-builds.html">custom build</a>
		works fine.</p>
</div>
<a onClick="console.log(window.CKEditorComment.getData())"> Log Contents </a>
<script src="../build/ckeditor.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@ckeditor/ckeditor5-inspector@1.5.0/build/inspector.js"></script>
<script>
	const cache = new Map();
	// function generateTokenRequest(collectionName, fieldName, documentId, userId, formType, linkSharingKey) {
	// 	return () => {
	// 		const cacheKey = `${collectionName}-${fieldName}-${documentId}-${userId}-${formType}-${linkSharingKey}`;
	// 		const cachedToken = cache.get(cacheKey);
	// 		if (cachedToken) {
	// 			return Promise.resolve(cachedToken);
	// 		}

	// 		const headers = {
	// 			'collection-name': collectionName,
	// 			'field-name': fieldName
	// 		};
			
	// 		if (linkSharingKey) {
	// 			headers['link-sharing-key'] = linkSharingKey;
	// 		}
	// 		if (documentId) {
	// 			headers['document-id'] = documentId;
	// 		}
	// 		if (userId) {
	// 			headers['user-id'] = userId;
	// 		}
	// 		if (formType) {
	// 			headers['form-type'] = formType;
	// 		}

	// 		return fetch('/ckeditor-token', {
	// 			method: 'GET',
	// 			headers
	// 		})
	// 		.then(response => {
	// 			if (!response.ok) {
	// 				throw new Error('Cannot download a new token!');
	// 			}
	// 			return response.text();
	// 		})
	// 		.then(token => {
	// 			cache.set(cacheKey, token);
	// 			return token;
	// 		});
	// 	}
	// }

	function generateTokenRequest() {
		return async () => 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJyUXZEM1ZudW5YWnUzNG04NmU1ZiIsImlhdCI6MTczMDUwNTg1MywidXNlciI6eyJpZCI6ImdyZWNISmNna2IzS1c1d25NIiwibmFtZSI6IlJvYmVydE0ifSwiYXV0aCI6eyJjb2xsYWJvcmF0aW9uIjp7InNadk1MV3JXb21OMjh1V0E5LWVkaXQiOnsicm9sZSI6IndyaXRlciJ9fX19.3qBpB9FUmTq5GcPEXqvTvmJbc-xun-de3ZyPcKYkVbs';
	}

	CKEditor.getPostEditorCollaboration('LessWrong').create( document.querySelector( '#editor' ), {
		collaboration: { channelId: "sZvMLWrWomN28uWA9-edit" },
		presenceList: { container: document.querySelector( '#presence-list-container' ) },
		cloudServices: {
			bundleVersion: "43.1.0",
			documentId: "test-local-build-edit",
			tokenUrl: generateTokenRequest('Posts', 'contents', 'test-local-build-edit', 'edit'),
			uploadUrl: "https://39669.cke-cs.com/easyimage/upload/",
			webSocketUrl: "39669.cke-cs.com/ws"
		}
	} )
		.then( editor => {
			CKEditorInspector.attach(editor);
			window.CKEditor = editor
			return editor 
		})
		.catch( err => {
			console.error( err.stack );
		} );
	CKEditor.getCommentEditor('LessWrong').create( document.querySelector( '#comment-editor' ) )
		.then( editor => {
			CKEditorInspector.attach(editor);
			window.CKEditorComment = editor
			return editor 
		})
		.catch( err => {
			console.error( err.stack );
		} );
</script>

</body>
</html>
